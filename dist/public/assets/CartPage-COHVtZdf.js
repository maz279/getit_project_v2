import{u as B,v as D,aO as K,r as S,j as e,aW as k,B as r,C as l,e as d,a as p,b as u,y as v,a$ as $,z as H,G as J,T as V,a5 as W}from"./index-BbFXQDnE.js";import{u as Y}from"./useQuery-CRIkWQSp.js";import{u as y}from"./useMutation-BWp-VuHD.js";import{S as _}from"./separator-BYLJil6H.js";import{I}from"./Input-CWq-fe6X.js";import{C as E}from"./checkbox-BMRz0kTp.js";import{S as U}from"./store-B5bAgGpV.js";import{M as X}from"./minus-RxNGvtwg.js";import{T as Z}from"./trash-2-CmRk35al.js";import{A as G}from"./arrow-right-BWVJbtCE.js";import"./index-7AG9p6tt.js";function me(){const[ee,T]=B(),{toast:c}=D(),j=K(),[o,f]=S.useState([]),[m,b]=S.useState(""),w=s=>T(s),{data:P,isLoading:q,error:A}=Y({queryKey:["/api/v1/cart"],queryFn:async()=>{const s=await fetch("/api/v1/cart");if(!s.ok)throw new Error("Failed to fetch cart");return s.json()}}),h=y({mutationFn:async({itemId:s,quantity:a})=>{const t=await fetch(`/api/v1/cart/items/${s}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:a})});if(!t.ok)throw new Error("Failed to update quantity");return t.json()},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/v1/cart"]})},onError:()=>{c({title:"Error",description:"Failed to update quantity",variant:"destructive"})}}),C=y({mutationFn:async s=>{const a=await fetch(`/api/v1/cart/items/${s}`,{method:"DELETE"});if(!a.ok)throw new Error("Failed to remove item");return a.json()},onSuccess:()=>{j.invalidateQueries({queryKey:["/api/v1/cart"]}),c({title:"Item Removed",description:"Item has been removed from your cart"})},onError:()=>{c({title:"Error",description:"Failed to remove item",variant:"destructive"})}}),g=y({mutationFn:async s=>{const a=await fetch("/api/v1/cart/coupon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:s})});if(!a.ok)throw new Error("Invalid coupon code");return a.json()},onSuccess:s=>{j.invalidateQueries({queryKey:["/api/v1/cart"]}),c({title:"Coupon Applied",description:`Discount of ৳${s.discount} applied successfully`}),b("")},onError:()=>{c({title:"Invalid Coupon",description:"The coupon code you entered is not valid",variant:"destructive"})}}),i=P||{subtotal:0,shipping:0,tax:0,discount:0,total:0,items:[]},x=i.items||[],L=x.reduce((s,a)=>(s[a.vendorId]||(s[a.vendorId]={vendorName:a.vendorName,items:[]}),s[a.vendorId].items.push(a),s),{}),N=(s,a)=>{a<1||h.mutate({itemId:s,quantity:a})},O=s=>{C.mutate(s)},F=(s,a)=>{f(t=>a?[...t,s]:t.filter(n=>n!==s))},z=s=>{f(s?x.map(a=>a.id):[])},M=()=>{m.trim()&&g.mutate(m.trim())},Q=()=>{if(o.length===0){c({title:"No Items Selected",description:"Please select items to proceed to checkout",variant:"destructive"});return}w("/checkout")};return A?e.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[e.jsx(k,{className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Error Loading Cart"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"There was an error loading your cart. Please try again."}),e.jsx(r,{onClick:()=>window.location.reload(),children:"Reload"})]}):q?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:[...Array(3)].map((s,a)=>e.jsx(l,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex space-x-4 animate-pulse",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/4"})]})]})})},a))}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(l,{children:e.jsx(d,{className:"p-6 animate-pulse",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded"}),e.jsx("div",{className:"h-12 bg-gray-200 rounded"})]})})})})]})}):x.length===0?e.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[e.jsx(k,{className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Your cart is empty"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Add some products to your cart to get started"}),e.jsx(r,{onClick:()=>w("/"),children:"Continue Shopping"})]}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Shopping Cart (",x.length," items)"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{checked:o.length===x.length,onCheckedChange:z}),e.jsx("span",{className:"text-sm",children:"Select All"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:Object.entries(L).map(([s,a])=>e.jsxs(l,{children:[e.jsx(p,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-5 h-5 text-blue-600"}),e.jsx(u,{className:"text-lg",children:a.vendorName}),e.jsxs(v,{variant:"secondary",children:[a.items.length," item",a.items.length!==1?"s":""]})]})}),e.jsx(d,{className:"space-y-4",children:a.items.map(t=>e.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[e.jsx(E,{checked:o.includes(t.id),onCheckedChange:n=>F(t.id,n)}),e.jsx("div",{className:"w-20 h-20 flex-shrink-0",children:e.jsx("img",{src:t.productImage,alt:t.productName,className:"w-full h-full object-cover rounded"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm mb-1 truncate",children:t.productName}),t.variants&&Object.entries(t.variants).length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:Object.entries(t.variants).map(([n,R])=>e.jsxs(v,{variant:"outline",className:"text-xs",children:[n,": ",R]},n))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-bold text-blue-600",children:["৳",t.price.toLocaleString()]}),!t.inStock&&e.jsx(v,{variant:"destructive",className:"text-xs",children:"Out of Stock"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r,{variant:"outline",size:"icon",onClick:()=>N(t.id,t.quantity-1),disabled:t.quantity<=1||h.isPending,children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx(I,{type:"number",value:t.quantity,onChange:n=>N(t.id,parseInt(n.target.value)||1),className:"w-16 text-center",min:"1",disabled:h.isPending}),e.jsx(r,{variant:"outline",size:"icon",onClick:()=>N(t.id,t.quantity+1),disabled:h.isPending,children:e.jsx($,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r,{variant:"ghost",size:"icon",className:"text-gray-500 hover:text-red-500",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>O(t.id),disabled:C.isPending,className:"text-gray-500 hover:text-red-500",children:e.jsx(Z,{className:"w-4 h-4"})})]})]},t.id))})]},s))}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"sticky top-6 space-y-6",children:[e.jsxs(l,{children:[e.jsx(p,{children:e.jsxs(u,{className:"text-lg flex items-center",children:[e.jsx(J,{className:"w-5 h-5 mr-2 text-green-600"}),"Coupon Code"]})}),e.jsx(d,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(I,{placeholder:"Enter coupon code",value:m,onChange:s=>b(s.target.value),disabled:g.isPending}),e.jsx(r,{onClick:M,disabled:!m.trim()||g.isPending,size:"sm",children:"Apply"})]})})]}),e.jsxs(l,{children:[e.jsx(p,{children:e.jsx(u,{className:"text-lg",children:"Order Summary"})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Subtotal (",o.length," items)"]}),e.jsxs("span",{children:["৳",i.subtotal.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Shipping"]}),e.jsxs("span",{children:["৳",i.shipping.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"VAT (15%)"}),e.jsxs("span",{children:["৳",i.tax.toLocaleString()]})]}),i.discount>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-৳",i.discount.toLocaleString()]})]}),e.jsx(_,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-blue-600",children:["৳",i.total.toLocaleString()]})]}),e.jsxs(r,{onClick:Q,disabled:o.length===0,className:"w-full",size:"lg",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Proceed to Checkout",e.jsx(G,{className:"w-4 h-4 ml-2"})]}),e.jsx("p",{className:"text-xs text-center text-gray-600",children:"Secure checkout powered by SSL encryption"})]})]}),e.jsxs(l,{children:[e.jsx(p,{children:e.jsx(u,{className:"text-lg",children:"Accepted Payment Methods"})}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 p-2 border rounded",children:[e.jsx("div",{className:"w-4 h-4 bg-pink-500 rounded"}),e.jsx("span",{className:"text-sm",children:"bKash"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 border rounded",children:[e.jsx("div",{className:"w-4 h-4 bg-orange-500 rounded"}),e.jsx("span",{className:"text-sm",children:"Nagad"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 border rounded",children:[e.jsx("div",{className:"w-4 h-4 bg-purple-500 rounded"}),e.jsx("span",{className:"text-sm",children:"Rocket"})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-2 border rounded",children:[e.jsx("div",{className:"w-4 h-4 bg-green-500 rounded"}),e.jsx("span",{className:"text-sm",children:"COD"})]})]})})]})]})})]})]})}export{me as default};
