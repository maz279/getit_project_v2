import{r as i,v as _,j as e,C as h,e as u,o as $,B as n,D as G,y as f,M as J,a5 as K,E as Z,w as ee,a8 as se}from"./index-BbFXQDnE.js";import{I as te}from"./Input-CWq-fe6X.js";import{T as ae,a as re,b as p,c as ie}from"./tabs-C_4eq9Ip.js";import{S as k,a as A,b as O,c as D,d as r}from"./select-CnlAahch.js";import{D as le,a as ne,b as ce,c as de,d as oe,e as me}from"./dialog-BYX9Qgqu.js";import{P as xe}from"./progress-DgorQBb9.js";import{d as he}from"./index-DGXJkqEo.js";import{S as ue}from"./ShippingApiService-MHXR_pMK.js";import{F as ge}from"./filter-DueI5JnT.js";import{P as T}from"./package-DaaEeyZO.js";import{D as pe}from"./download-D5vec4LB.js";import{R as je}from"./rotate-ccw-DipCAHdP.js";import{C as ve}from"./circle-x-2gQK2BAa.js";import{A as fe}from"./arrow-right-BWVJbtCE.js";import"./index-ByjSl0Ku.js";import"./index-BdQq_4o_.js";import"./Combination-D3IprPQZ.js";import"./index-7AG9p6tt.js";import"./chevron-up-CwwMYm58.js";const qe=({userId:E})=>{const[c,j]=i.useState([]),[y,P]=i.useState([]),[ye,L]=i.useState(null),[v,R]=i.useState(null),[F,N]=i.useState(!1),[d,b]=i.useState(""),[x,w]=i.useState("all"),[o,C]=i.useState("all"),[g,I]=i.useState("all"),{toast:l}=_();i.useEffect(()=>{M(),z()},[E]),i.useEffect(()=>{U()},[c,d,x,o,g]);const M=async()=>{try{N(!0);const s=await OrderApiService.getUserOrders();j(s)}catch(s){console.error("Error loading orders:",s),l({title:"Error",description:"Failed to load order history",variant:"destructive"})}finally{N(!1)}},z=async()=>{try{const s=await OrderApiService.getOrderAnalytics();R(s)}catch(s){console.error("Error loading analytics:",s)}},U=()=>{let s=[...c];switch(g){case"active":s=s.filter(t=>["pending","confirmed","processing","shipped"].includes(t.status));break;case"delivered":s=s.filter(t=>t.status==="delivered");break;case"cancelled":s=s.filter(t=>["cancelled","returned"].includes(t.status));break}if(d&&(s=s.filter(t=>t.orderNumber.toLowerCase().includes(d.toLowerCase())||t.items.some(a=>a.productName.toLowerCase().includes(d.toLowerCase()))||t.vendor.storeName.toLowerCase().includes(d.toLowerCase()))),x!=="all"&&(s=s.filter(t=>t.status===x)),o!=="all"){const t=new Date,a=new Date;switch(o){case"week":a.setDate(t.getDate()-7);break;case"month":a.setMonth(t.getMonth()-1);break;case"quarter":a.setMonth(t.getMonth()-3);break;case"year":a.setFullYear(t.getFullYear()-1);break}o!=="all"&&(s=s.filter(m=>new Date(m.orderDate)>=a))}P(s)},q=async s=>{if(!s.tracking){l({title:"Tracking Unavailable",description:"Tracking information is not yet available for this order",variant:"destructive"});return}try{const t=await ue.trackOrder(s.tracking.trackingNumber);j(a=>a.map(m=>m.id===s.id?{...m,tracking:{...m.tracking,...t}}:m)),L({...s,tracking:{...s.tracking,...t}})}catch(t){console.error("Error tracking order:",t),l({title:"Tracking Error",description:"Unable to fetch latest tracking information",variant:"destructive"})}},Y=async s=>{try{const t=await OrderApiService.reorderItems(s.id);l({title:"Success",description:`${t.itemsAdded} items added to cart`})}catch(t){console.error("Error reordering items:",t),l({title:"Reorder Error",description:"Some items may no longer be available",variant:"destructive"})}},V=async s=>{try{await OrderApiService.cancelOrder(s.id),j(t=>t.map(a=>a.id===s.id?{...a,status:"cancelled"}:a)),l({title:"Order Cancelled",description:"Your order has been cancelled successfully"})}catch(t){console.error("Error cancelling order:",t),l({title:"Cancellation Error",description:"Unable to cancel the order",variant:"destructive"})}},B=async s=>{try{await OrderApiService.requestReturn(s.id),l({title:"Return Requested",description:"Your return request has been submitted"})}catch(t){console.error("Error requesting return:",t),l({title:"Return Error",description:"Unable to submit return request",variant:"destructive"})}},H=async s=>{try{const t=await OrderApiService.downloadInvoice(s.id);window.open(t,"_blank")}catch(t){console.error("Error downloading invoice:",t),l({title:"Download Error",description:"Unable to download invoice",variant:"destructive"})}},W=s=>{switch(s){case"delivered":return"bg-green-100 text-green-800";case"shipped":return"bg-blue-100 text-blue-800";case"processing":return"bg-yellow-100 text-yellow-800";case"confirmed":return"bg-purple-100 text-purple-800";case"pending":return"bg-gray-100 text-gray-800";case"cancelled":return"bg-red-100 text-red-800";case"returned":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},S=s=>{switch(s){case"paid":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";case"refunded":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},Q=s=>e.jsx(he,{className:"h-4 w-4"}),X=s=>{switch(s){case"pending":return 10;case"confirmed":return 25;case"processing":return 50;case"shipped":return 75;case"delivered":return 100;default:return 0}};return F&&c.length===0?e.jsx("div",{className:"container mx-auto p-6",children:e.jsx("div",{className:"grid gap-4",children:[1,2,3].map(s=>e.jsx(h,{className:"animate-pulse",children:e.jsx(u,{className:"p-6",children:e.jsx("div",{className:"h-32 bg-gray-200 rounded"})})},s))})}):e.jsxs("div",{className:"container mx-auto p-6 max-w-6xl space-y-6",children:[e.jsxs("div",{className:"grid lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-3",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Order History"}),e.jsx("p",{className:"text-gray-600",children:"Track and manage your orders"})]}),v&&e.jsx(h,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:v.totalOrders}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Orders"}),e.jsxs("div",{className:"text-lg font-semibold text-green-600 mt-2",children:["৳",v.totalSpent.toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Total Spent"})]})})})]}),e.jsx(h,{children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(te,{placeholder:"Search orders...",value:d,onChange:s=>b(s.target.value),className:"pl-10"})]}),e.jsxs(k,{value:x,onValueChange:w,children:[e.jsx(A,{children:e.jsx(O,{placeholder:"Filter by status"})}),e.jsxs(D,{children:[e.jsx(r,{value:"all",children:"All Status"}),e.jsx(r,{value:"pending",children:"Pending"}),e.jsx(r,{value:"confirmed",children:"Confirmed"}),e.jsx(r,{value:"processing",children:"Processing"}),e.jsx(r,{value:"shipped",children:"Shipped"}),e.jsx(r,{value:"delivered",children:"Delivered"}),e.jsx(r,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs(k,{value:o,onValueChange:C,children:[e.jsx(A,{children:e.jsx(O,{placeholder:"Filter by date"})}),e.jsxs(D,{children:[e.jsx(r,{value:"all",children:"All Time"}),e.jsx(r,{value:"week",children:"Last Week"}),e.jsx(r,{value:"month",children:"Last Month"}),e.jsx(r,{value:"quarter",children:"Last 3 Months"}),e.jsx(r,{value:"year",children:"Last Year"})]})]}),e.jsxs(n,{variant:"outline",onClick:()=>{b(""),w("all"),C("all")},children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Clear Filters"]})]})})}),e.jsxs(ae,{value:g,onValueChange:I,children:[e.jsxs(re,{className:"grid w-full grid-cols-4",children:[e.jsxs(p,{value:"all",children:["All Orders (",c.length,")"]}),e.jsxs(p,{value:"active",children:["Active (",c.filter(s=>["pending","confirmed","processing","shipped"].includes(s.status)).length,")"]}),e.jsxs(p,{value:"delivered",children:["Delivered (",c.filter(s=>s.status==="delivered").length,")"]}),e.jsxs(p,{value:"cancelled",children:["Cancelled (",c.filter(s=>["cancelled","returned"].includes(s.status)).length,")"]})]}),e.jsx(ie,{value:g,className:"space-y-4 mt-6",children:y.length===0?e.jsx(h,{children:e.jsxs(u,{className:"p-8 text-center",children:[e.jsx(T,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No orders found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:d||x!=="all"||o!=="all"?"Try adjusting your search criteria":"You haven't placed any orders yet"}),e.jsxs(n,{onClick:()=>window.location.href="/",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Start Shopping"]})]})}):y.map(s=>e.jsx(h,{className:"overflow-hidden",children:e.jsxs(u,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium",children:["Order #",s.orderNumber]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.vendor.storeName})]}),e.jsx(f,{className:W(s.status),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)}),e.jsx(f,{className:S(s.paymentStatus),children:s.paymentStatus.charAt(0).toUpperCase()+s.paymentStatus.slice(1)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold",children:["৳",s.totalAmount.toLocaleString()]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.orderDate})]})]}),["pending","confirmed","processing","shipped","delivered"].includes(s.status)&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[e.jsx("span",{children:"Order Progress"}),e.jsx("span",{children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]}),e.jsx(xe,{value:X(s.status),className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[s.items.slice(0,3).map(t=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex-shrink-0",children:t.productImage?e.jsx("img",{src:t.productImage,alt:t.productName,className:"w-full h-full object-cover rounded-lg"}):e.jsx(T,{className:"w-full h-full p-2 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.productName}),t.variant&&e.jsx("p",{className:"text-xs text-gray-500",children:t.variant}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Qty: ",t.quantity," × ৳",t.unitPrice]})]})]},t.id)),s.items.length>3&&e.jsx("div",{className:"flex items-center justify-center p-3 bg-gray-50 rounded-lg",children:e.jsxs("span",{className:"text-sm text-gray-600",children:["+",s.items.length-3," more items"]})})]}),s.tracking&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[Q(s.tracking.courier),e.jsx("span",{className:"text-sm font-medium capitalize",children:s.tracking.courier}),e.jsxs("span",{className:"text-sm text-gray-600",children:["#",s.tracking.trackingNumber]})]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>q(s),children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Track"]})]}),s.tracking.currentLocation&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Current location: ",s.tracking.currentLocation]}),s.tracking.estimatedDelivery&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Estimated delivery: ",s.tracking.estimatedDelivery]})]}),s.mobilePayment&&e.jsxs("div",{className:"mb-4 p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium capitalize",children:s.mobilePayment.provider}),e.jsxs("span",{className:"text-sm text-gray-600",children:["#",s.mobilePayment.transactionId]})]}),e.jsx(f,{className:S(s.mobilePayment.status),children:s.mobilePayment.status})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Amount: ৳",s.mobilePayment.amount," (Fee: ৳",s.mobilePayment.fee,")"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(le,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(n,{variant:"outline",size:"sm",children:[e.jsx(Z,{className:"h-4 w-4 mr-1"}),"View Details"]})}),e.jsxs(ce,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(de,{children:[e.jsxs(oe,{children:["Order Details - #",s.orderNumber]}),e.jsx(me,{children:"Complete order information and tracking"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Order Information"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:["Order Date: ",s.orderDate]}),e.jsxs("p",{children:["Status: ",s.status]}),e.jsxs("p",{children:["Payment Method: ",s.paymentMethod]}),e.jsxs("p",{children:["Total: ৳",s.totalAmount.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Shipping Address"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:s.shippingAddress.name}),e.jsx("p",{children:s.shippingAddress.phone}),e.jsx("p",{children:s.shippingAddress.address}),e.jsxs("p",{children:[s.shippingAddress.area,", ",s.shippingAddress.city]}),e.jsxs("p",{children:["Postal Code: ",s.shippingAddress.postalCode]})]})]})]})})]})]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>H(s),children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"Invoice"]}),s.status==="delivered"&&e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>Y(s),children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),"Reorder"]}),["pending","confirmed"].includes(s.status)&&e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>V(s),children:[e.jsx(ve,{className:"h-4 w-4 mr-1"}),"Cancel"]}),s.status==="delivered"&&e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>B(s),children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),"Return"]}),s.items.some(t=>t.canReview&&!t.reviewed)&&e.jsxs(n,{variant:"outline",size:"sm",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),"Write Review"]}),e.jsxs(n,{variant:"outline",size:"sm",children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"Contact Seller"]})]})]})},s.id))})]})]})};export{qe as default};
