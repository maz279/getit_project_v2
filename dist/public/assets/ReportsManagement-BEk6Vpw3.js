import{v as X,aO as Z,r as y,j as e,B as o,a$ as ee,C as n,a as m,b as h,d as x,e as c,U as se,D as ae,y as d,be as te,o as le,$ as re,i as ie}from"./index-BbFXQDnE.js";import{u as D}from"./useQuery-CRIkWQSp.js";import{u as V}from"./useMutation-BWp-VuHD.js";import{I as q}from"./Input-CWq-fe6X.js";import{L as i}from"./label-qlckO57s.js";import{C as L}from"./checkbox-BMRz0kTp.js";import{T as ne,a as ce,b as g,c as v}from"./tabs-C_4eq9Ip.js";import{S as f,a as N,b as C,c as w,d as t}from"./select-CnlAahch.js";import{T as de}from"./textarea-CX8_TXW8.js";import{m as E}from"./proxy-DDa1Qohe.js";import{C as oe}from"./chart-column-BfcxbdnJ.js";import{P as me}from"./package-DaaEeyZO.js";import{C as P}from"./clock-R8mzfB_N.js";import{D as he}from"./download-D5vec4LB.js";import{T as xe}from"./trash-2-CmRk35al.js";import{S as pe}from"./settings-ejHX-wzh.js";import{C as ue}from"./circle-alert-CyvoZE1T.js";import"./index-7AG9p6tt.js";import"./index-ByjSl0Ku.js";import"./index-BdQq_4o_.js";import"./Combination-D3IprPQZ.js";import"./chevron-up-CwwMYm58.js";const Ue=()=>{const{toast:p}=X(),M=Z(),[O,b]=y.useState("generate"),[u,I]=y.useState(""),[j,U]=y.useState("all"),[l,r]=y.useState({name:"",description:"",type:"comprehensive",format:"excel",period:"last30Days",sections:["sales","customers","vendors","products"],includeCharts:!0,includeBangladeshMetrics:!0,scheduledGeneration:!1,schedule:{frequency:"weekly",dayOfWeek:"monday",time:"09:00"}}),{data:S,isLoading:je,refetch:ye}=D({queryKey:["/api/v1/analytics/reports/list"],enabled:!0,refetchInterval:3e4}),{data:R,isLoading:ge}=D({queryKey:["/api/v1/analytics/reports/templates"],enabled:!0}),{data:T,isLoading:ve}=D({queryKey:["/api/v1/analytics/reports/scheduled"],enabled:!0}),k=V({mutationFn:async s=>(await fetch("/api/v1/analytics/reports/comprehensive",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json(),onSuccess:()=>{p({title:"Report Generation Started",description:"Your report is being generated and will be ready shortly."}),M.invalidateQueries({queryKey:["/api/v1/analytics/reports/list"]}),r({name:"",description:"",type:"comprehensive",format:"excel",period:"last30Days",sections:["sales","customers","vendors","products"],includeCharts:!0,includeBangladeshMetrics:!0,scheduledGeneration:!1,schedule:{frequency:"weekly",dayOfWeek:"monday",time:"09:00"}})},onError:()=>{p({title:"Report Generation Failed",description:"There was an error generating your report. Please try again.",variant:"destructive"})}}),B=V({mutationFn:async s=>(await fetch(`/api/v1/analytics/reports/${s}`,{method:"DELETE"})).json(),onSuccess:()=>{p({title:"Report Deleted",description:"Report has been successfully deleted."}),M.invalidateQueries({queryKey:["/api/v1/analytics/reports/list"]})}}),z=(S==null?void 0:S.reports)||[],Y=(R==null?void 0:R.templates)||[],K=(T==null?void 0:T.scheduled)||[],Q=()=>{k.mutate(l)},$=s=>{B.mutate(s)},H=s=>{s.downloadUrl?window.open(s.downloadUrl,"_blank"):p({title:"Download Not Available",description:"Report download is not available yet.",variant:"destructive"})},J=s=>{r(a=>({...a,sections:a.sections.includes(s)?a.sections.filter(F=>F!==s):[...a.sections,s]}))},A=z.filter(s=>{var G;const a=s.name.toLowerCase().includes(u.toLowerCase())||((G=s.description)==null?void 0:G.toLowerCase().includes(u.toLowerCase())),F=j==="all"||s.status===j;return a&&F}),W=s=>{switch(s){case"completed":return e.jsx(ie,{className:"h-4 w-4 text-green-600"});case"generating":return e.jsx(P,{className:"h-4 w-4 text-blue-600 animate-spin"});case"failed":return e.jsx(ue,{className:"h-4 w-4 text-red-600"});default:return e.jsx(P,{className:"h-4 w-4 text-gray-600"})}},_=s=>{switch(s){case"completed":return"bg-green-100 text-green-700";case"generating":return"bg-blue-100 text-blue-700";case"failed":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-8",children:[e.jsxs(E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white",children:"Reports Management"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"Generate and manage comprehensive analytics reports"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(o,{onClick:()=>b("generate"),variant:O==="generate"?"default":"outline",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"New Report"]})})]}),e.jsxs(ne,{value:O,onValueChange:b,className:"space-y-6",children:[e.jsxs(ce,{className:"grid w-full grid-cols-4",children:[e.jsx(g,{value:"generate",children:"Generate Report"}),e.jsx(g,{value:"reports",children:"My Reports"}),e.jsx(g,{value:"templates",children:"Templates"}),e.jsx(g,{value:"scheduled",children:"Scheduled"})]}),e.jsx(v,{value:"generate",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(n,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"Report Configuration"}),e.jsx(x,{children:"Configure your analytics report settings"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"reportName",children:"Report Name"}),e.jsx(q,{id:"reportName",placeholder:"Enter report name",value:l.name,onChange:s=>r(a=>({...a,name:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"reportType",children:"Report Type"}),e.jsxs(f,{value:l.type,onValueChange:s=>r(a=>({...a,type:s})),children:[e.jsx(N,{children:e.jsx(C,{placeholder:"Select type"})}),e.jsxs(w,{children:[e.jsx(t,{value:"comprehensive",children:"Comprehensive"}),e.jsx(t,{value:"sales",children:"Sales Only"}),e.jsx(t,{value:"customers",children:"Customers Only"}),e.jsx(t,{value:"vendors",children:"Vendors Only"}),e.jsx(t,{value:"products",children:"Products Only"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"reportFormat",children:"Format"}),e.jsxs(f,{value:l.format,onValueChange:s=>r(a=>({...a,format:s})),children:[e.jsx(N,{children:e.jsx(C,{placeholder:"Select format"})}),e.jsxs(w,{children:[e.jsx(t,{value:"excel",children:"Excel (.xlsx)"}),e.jsx(t,{value:"pdf",children:"PDF"}),e.jsx(t,{value:"csv",children:"CSV"}),e.jsx(t,{value:"json",children:"JSON"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"reportPeriod",children:"Time Period"}),e.jsxs(f,{value:l.period,onValueChange:s=>r(a=>({...a,period:s})),children:[e.jsx(N,{children:e.jsx(C,{placeholder:"Select period"})}),e.jsxs(w,{children:[e.jsx(t,{value:"today",children:"Today"}),e.jsx(t,{value:"yesterday",children:"Yesterday"}),e.jsx(t,{value:"last7Days",children:"Last 7 Days"}),e.jsx(t,{value:"last30Days",children:"Last 30 Days"}),e.jsx(t,{value:"last90Days",children:"Last 90 Days"}),e.jsx(t,{value:"thisYear",children:"This Year"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"reportDescription",children:"Description (Optional)"}),e.jsx(de,{id:"reportDescription",placeholder:"Enter report description",value:l.description,onChange:s=>r(a=>({...a,description:s.target.value}))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{children:"Report Sections"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{id:"sales",label:"Sales Analytics",icon:oe},{id:"customers",label:"Customer Insights",icon:se},{id:"vendors",label:"Vendor Performance",icon:ae},{id:"products",label:"Product Analytics",icon:me}].map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{id:s.id,checked:l.sections.includes(s.id),onCheckedChange:()=>J(s.id)}),e.jsxs(i,{htmlFor:s.id,className:"flex items-center gap-2 text-sm font-medium cursor-pointer",children:[e.jsx(s.icon,{className:"h-4 w-4"}),s.label]})]},s.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{children:"Additional Options"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{id:"includeCharts",checked:l.includeCharts,onCheckedChange:s=>r(a=>({...a,includeCharts:s}))}),e.jsx(i,{htmlFor:"includeCharts",className:"text-sm",children:"Include Charts & Visualizations"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{id:"includeBangladeshMetrics",checked:l.includeBangladeshMetrics,onCheckedChange:s=>r(a=>({...a,includeBangladeshMetrics:s}))}),e.jsx(i,{htmlFor:"includeBangladeshMetrics",className:"text-sm",children:"Include Bangladesh-Specific Metrics"})]})]})]})]})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs(n,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"Report Preview"}),e.jsx(x,{children:"Your report will include:"})]}),e.jsxs(c,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Format"}),e.jsx(d,{variant:"outline",children:l.format.toUpperCase()})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Period"}),e.jsx(d,{variant:"outline",children:l.period})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Sections"}),e.jsx(d,{variant:"outline",children:l.sections.length})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Charts"}),e.jsx(d,{variant:l.includeCharts?"default":"secondary",children:l.includeCharts?"Yes":"No"})]})]}),e.jsx(o,{className:"w-full mt-4",onClick:Q,disabled:!l.name||l.sections.length===0||k.isPending,children:k.isPending?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Generate Report"]})})]})]})})]})}),e.jsxs(v,{value:"reports",className:"space-y-6",children:[e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(q,{placeholder:"Search reports...",value:u,onChange:s=>I(s.target.value),className:"pl-8"})]})}),e.jsxs(f,{value:j,onValueChange:U,children:[e.jsx(N,{className:"w-48",children:e.jsx(C,{placeholder:"Filter by status"})}),e.jsxs(w,{children:[e.jsx(t,{value:"all",children:"All Reports"}),e.jsx(t,{value:"completed",children:"Completed"}),e.jsx(t,{value:"generating",children:"Generating"}),e.jsx(t,{value:"failed",children:"Failed"})]})]})]})})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:A.map(s=>e.jsx(E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},whileHover:{scale:1.02},transition:{duration:.2},children:e.jsxs(n,{className:"h-full",children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-lg",children:s.name}),e.jsx(x,{className:"mt-1",children:s.description||`${s.type} report`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[W(s.status),e.jsx(d,{className:_(s.status),children:s.status})]})]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Format:"}),e.jsx("span",{className:"font-medium",children:s.format.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Period:"}),e.jsx("span",{className:"font-medium",children:s.period})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Created:"}),e.jsx("span",{className:"font-medium",children:new Date(s.createdAt).toLocaleDateString()})]}),s.fileSize&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Size:"}),e.jsx("span",{className:"font-medium",children:s.fileSize})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[s.status==="completed"&&e.jsxs(o,{size:"sm",onClick:()=>H(s),className:"flex-1",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Download"]}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>$(s.id),disabled:B.isPending,children:e.jsx(xe,{className:"h-4 w-4"})})]})]})]})},s.id))}),A.length===0&&e.jsx(n,{children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(re,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No Reports Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:u||j!=="all"?"No reports match your current filters.":"You haven't generated any reports yet."})]})})]}),e.jsx(v,{value:"templates",className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Y.map(s=>e.jsxs(n,{className:"h-full",children:[e.jsxs(m,{children:[e.jsx(h,{className:"text-lg",children:s.name}),e.jsx(x,{children:s.description})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx(d,{variant:"outline",children:s.category})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Sections:"}),e.jsx("span",{className:"font-medium",children:s.sections.length})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Format:"}),e.jsx("span",{className:"font-medium",children:s.defaultFormat.toUpperCase()})]})]}),e.jsx(o,{className:"w-full",variant:"outline",onClick:()=>{r(a=>({...a,type:s.category,format:s.defaultFormat,sections:s.sections})),b("generate")},children:"Use Template"})]})]},s.id))})}),e.jsx(v,{value:"scheduled",className:"space-y-6",children:e.jsxs(n,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"Scheduled Reports"}),e.jsx(x,{children:"Automatically generated reports based on your schedule"})]}),e.jsx(c,{children:e.jsx("div",{className:"space-y-4",children:K.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.frequency," • Next: ",s.nextRun]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:s.active?"default":"secondary",children:s.active?"Active":"Inactive"}),e.jsx(o,{size:"sm",variant:"outline",children:e.jsx(pe,{className:"h-4 w-4"})})]})]},s.id))})})]})})]})]})})};export{Ue as default};
