// Comprehensive Location Selection Test Script
// Run this in the browser console to test all location selection functionality

console.log('üß™ Starting comprehensive location selection test...\n');

// Test 1: Check if location data is available
console.log('1. Testing location data availability...');
const locationData = [
  { id: 'dhaka-dhaka', city: 'Dhaka', expected: true },
  { id: 'narayanganj-dhaka', city: 'Narayanganj', expected: true },
  { id: 'gazipur-dhaka', city: 'Gazipur', expected: true },
  { id: 'chittagong-chittagong', city: 'Chittagong', expected: true },
  { id: 'sylhet-sylhet', city: 'Sylhet', expected: true },
  { id: 'rajshahi-rajshahi', city: 'Rajshahi', expected: true },
  { id: 'khulna-khulna', city: 'Khulna', expected: true }
];

// Test 2: Check if location menu button exists
console.log('2. Testing location menu button...');
const locationButton = document.querySelector('button[class*="text-orange-600"]');
if (locationButton) {
  console.log('‚úÖ Location menu button found');
} else {
  console.log('‚ùå Location menu button not found');
}

// Test 3: Simulate location menu click
console.log('3. Testing location menu click...');
if (locationButton) {
  locationButton.click();
  setTimeout(() => {
    const locationMenu = document.querySelector('div[class*="absolute top-full left-0"]');
    if (locationMenu) {
      console.log('‚úÖ Location menu opened successfully');
      
      // Test 4: Check if search input exists
      console.log('4. Testing search input...');
      const searchInput = locationMenu.querySelector('input[placeholder*="Search"]');
      if (searchInput) {
        console.log('‚úÖ Search input found');
        
        // Test 5: Test search functionality
        console.log('5. Testing search functionality...');
        searchInput.value = 'Narayanganj';
        searchInput.dispatchEvent(new Event('input', { bubbles: true }));
        
        setTimeout(() => {
          const searchResults = locationMenu.querySelectorAll('button[class*="border-gray-100"]');
          console.log(`‚úÖ Search results found: ${searchResults.length} locations`);
          
          // Test 6: Test location selection
          console.log('6. Testing location selection...');
          const narayanganjButton = Array.from(searchResults).find(btn => 
            btn.textContent.includes('Narayanganj')
          );
          
          if (narayanganjButton) {
            console.log('‚úÖ Narayanganj button found');
            
            // Store original location
            const originalLocation = locationButton.textContent;
            console.log(`Original location: ${originalLocation}`);
            
            // Click Narayanganj
            narayanganjButton.click();
            
            setTimeout(() => {
              const newLocation = document.querySelector('button[class*="text-orange-600"]').textContent;
              console.log(`New location: ${newLocation}`);
              
              if (newLocation.includes('Narayanganj')) {
                console.log('‚úÖ Location selection successful!');
                
                // Test 7: Check localStorage persistence
                console.log('7. Testing localStorage persistence...');
                const savedLocation = localStorage.getItem('selectedLocation');
                if (savedLocation) {
                  const parsedLocation = JSON.parse(savedLocation);
                  if (parsedLocation.city === 'Narayanganj') {
                    console.log('‚úÖ localStorage persistence working');
                  } else {
                    console.log('‚ùå localStorage persistence failed');
                  }
                } else {
                  console.log('‚ùå No saved location found in localStorage');
                }
                
                // Test 8: Check notification
                console.log('8. Testing notification...');
                const notification = document.querySelector('div[class*="fixed top-4 right-4 bg-green-500"]');
                if (notification) {
                  console.log('‚úÖ Notification displayed');
                } else {
                  console.log('‚ùå Notification not found');
                }
                
                console.log('\nüéâ All tests completed!');
                console.log('üìä Test Results Summary:');
                console.log('‚úÖ Location data: Available');
                console.log('‚úÖ Menu button: Working');
                console.log('‚úÖ Menu opening: Working');
                console.log('‚úÖ Search input: Working');
                console.log('‚úÖ Search functionality: Working');
                console.log('‚úÖ Location selection: Working');
                console.log('‚úÖ localStorage persistence: Working');
                console.log('‚úÖ Notification: Working');
                
              } else {
                console.log('‚ùå Location selection failed - text not updated');
              }
            }, 100);
          } else {
            console.log('‚ùå Narayanganj button not found in search results');
          }
        }, 100);
      } else {
        console.log('‚ùå Search input not found');
      }
    } else {
      console.log('‚ùå Location menu did not open');
    }
  }, 100);
} else {
  console.log('‚ùå Cannot test - location button not found');
}

// Test 9: Test language switching
console.log('9. Testing language switching...');
setTimeout(() => {
  const languageButton = document.querySelector('button[class*="text-gray-700 hover:text-orange-600"]');
  if (languageButton) {
    console.log('‚úÖ Language button found');
    const originalText = languageButton.textContent;
    languageButton.click();
    
    setTimeout(() => {
      const newText = languageButton.textContent;
      if (newText !== originalText) {
        console.log('‚úÖ Language switching working');
      } else {
        console.log('‚ùå Language switching failed');
      }
    }, 100);
  } else {
    console.log('‚ùå Language button not found');
  }
}, 2000);

// Test 10: Test manual location selection from popular locations
console.log('10. Testing manual location selection from popular locations...');
setTimeout(() => {
  // Open location menu again
  const locationButton = document.querySelector('button[class*="text-orange-600"]');
  if (locationButton) {
    locationButton.click();
    
    setTimeout(() => {
      const locationMenu = document.querySelector('div[class*="absolute top-full left-0"]');
      if (locationMenu) {
        // Find all popular location buttons
        const popularButtons = locationMenu.querySelectorAll('button[class*="border-gray-100"]');
        console.log(`Found ${popularButtons.length} popular location buttons`);
        
        // Try to click on different locations
        const locations = ['Dhaka', 'Chittagong', 'Sylhet'];
        locations.forEach((location, index) => {
          const locationButton = Array.from(popularButtons).find(btn => 
            btn.textContent.includes(location)
          );
          if (locationButton) {
            console.log(`‚úÖ ${location} button found`);
          } else {
            console.log(`‚ùå ${location} button not found`);
          }
        });
      }
    }, 100);
  }
}, 3000);

console.log('\n‚è≥ Running comprehensive tests... Please wait for results...\n');